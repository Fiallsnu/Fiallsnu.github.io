<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½©è½©å¤©å¤©å¼€å¿ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            overflow: hidden;
            font-family: "Microsoft YaHei", "SimHei", Arial, sans-serif;
        }
        
        #canvas {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        #countdownCanvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 2;
        }
        
        #stage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
        }
        
        #exitHint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            pointer-events: none;
            z-index: 4;
        }
        
        .msg {
            position: absolute;
            left: 50%;
            top: 50%;
            padding: 16px 26px;
            border-radius: 18px;
            color: #fff;
            font-weight: 700;
            font-size: clamp(16px, 3.5vmin, 28px);
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transform: translate(-50%, -50%) translate(var(--dx), var(--dy)) scale(0.7) rotate(var(--rot));
            animation: fly var(--dur) cubic-bezier(0.25, 0.7, 0.3, 1) var(--delay) both;
            box-shadow: 0 8px 26px rgba(0, 0, 0, 0.25);
        }
        
        @keyframes fly {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) translate(var(--dx), var(--dy)) scale(0.7) rotate(var(--rot));
            }
            15% {
                opacity: 1;
            }
            55% {
                opacity: 1;
                transform: translate(-50%, -50%) translate(calc(var(--dx) * 0.1), calc(var(--dy) * 0.1)) scale(1.02);
            }
            90% {
                opacity: 1;
                transform: translate(-50%, -50%) translate(0, 0) scale(1) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) translate(0, 0) scale(1.03);
            }
        }
        
        .music-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            cursor: pointer;
        }
        
        .music-indicator::after {
            content: "â™ª";
            color: white;
            font-size: 16px;
        }
        
        .music-indicator.playing::after {
            content: "â™«";
            color: #ff758c;
        }
    </style>
</head>
<body>
    <canvas id="countdownCanvas"></canvas>
    <div id="stage"></div>
    <div id="exitHint"></div>
    
    <!-- éŸ³ä¹æŒ‡ç¤ºå™¨ -->
    <div class="music-indicator" id="musicIndicator"></div>
    
    <!-- éŸ³é¢‘å…ƒç´  -->
    <!-- æ³¨æ„ï¼šè¯·å°†ä¸‹é¢çš„éŸ³é¢‘æ–‡ä»¶è·¯å¾„æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„éŸ³ä¹æ–‡ä»¶ -->
    <audio id="backgroundMusic" loop>
        <source src="é‡è§.mp3" type="audio/mp3">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>

    <script>
        // è·å–å±å¹•å°ºå¯¸
        const SCREEN_WIDTH = window.innerWidth;
        const SCREEN_HEIGHT = window.innerHeight;
        
        // é¢œè‰²å®šä¹‰
        const BLACK = '#000000';
        const WHITE = '#FFFFFF';
        
        // é£å¹•æç¤ºå†…å®¹
        const TIPS = [
    		'ğŸ’– æˆ‘å–œæ¬¢ä½  ğŸ’–', 'âœ¨ ä½ çš„ç¬‘å®¹çœŸç¾ âœ¨', 'ğŸŒ¹ çˆ±ä½ æ¯ä¸€å¤© ğŸŒ¹', 'ğŸ’• å¿ƒå¿ƒç›¸å° ğŸ’•',
            'ğŸŒŸ æƒ³ä½  ğŸŒŸ', 'ğŸ€ æœ€çˆ±æ˜¯ä½  ğŸ€', 'ğŸŒ™ æ™šå®‰å¥½æ¢¦ ğŸŒ™', 'ğŸ’§ ç…§é¡¾å¥½è‡ªå·± ğŸ’§',
            'ğŸŒº æ€å¿µå¦‚èŠ± ğŸŒº', 'ğŸ’ ä½ æ˜¯æˆ‘çš„ä¸€åˆ‡ ğŸ’', 
            'å¤©å¤©å¼€å¿ƒ', 'æˆ‘å¥½æƒ³ä½ ', 'ç…§é¡¾å¥½è‡ªå·±', 'æˆ‘å¥½çˆ±ä½ ', 'è®°å¾—å¤šç©¿è¡£æœ', 'è®°å¾—å¼€å¿ƒ', 'ä¸€åˆ‡é¡ºåˆ©',
            'ä½ è¦å¥½å¥½çš„', 'æˆ‘ä¼šä¸€ç›´åœ¨', 'å˜¿å˜¿', 'æˆ‘åœ¨å‘¢', 'å®å®åŠ æ²¹', 'æ—©ç‚¹ä¼‘æ¯', 'å¤šå–çƒ­æ°´', 'å‡ºé—¨å¸¦ä¼',
            'æŒ‰æ—¶åƒé¥­', 'æƒ³ä½ çš„ä¸€å¤©', 'æŠ±æŠ±ä½ ', 'ä¸æ€• æœ‰æˆ‘å‘¢', 'ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡', 'è½©è½©å¤©å¤©å¼€å¿ƒ', 'å°å¿ƒæ„Ÿå†’',
            'è·¯ä¸Šæ³¨æ„å®‰å…¨', 'æ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸€æ¡ğŸŸè§£å†³ä¸äº†çš„ï¼Œå¦‚æœæœ‰é‚£å°±ä¸¤æ¡', 'ä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥', 'æ…¢æ…¢æ¥ä¸ç€æ€¥', 'ç¬‘ä¸€ç¬‘', 'æ‘¸æ‘¸å¤´', 'å¥½æ¢¦å¸¸åœ¨',
            'é˜³å…‰ä¼šæ¥çš„', 'æˆ‘ç­‰ä½ ', 'åˆ«ç†¬å¤œå•¦', 'å–ç‚¹çƒ­æ±¤', 'è®°å¾—åƒæ—©é¤', 'ä»Šå¤©ä¼šæ›´å¥½', 'ä½ å€¼å¾—è¢«çˆ±',
            'å°è½©å¤©å¤©å¼€å¿ƒ', 'æˆ‘è¶…å–œæ¬¢ä½ ', 'åˆ«æ€•æˆ‘åœ¨', 'æƒ³ä½ æƒ³ä½ ğŸ’–', 'ç»™ä½ å°èŠ±èŠ±ğŸŒ¹', 'å°å¹¸è¿åœ¨è·¯ä¸Š',
            'æ„¿ä½ å¿ƒæƒ…æ™´æœ—', 'å¤©æ°”å†·äº†åŠ è¡£', 'æ¸©æŸ”ä»¥å¾…è‡ªå·±', 'ä½ çš„ç¬‘çœŸå¥½çœ‹', 'ä¿æŒå¯çˆ±', 'å‡ºé—¨é¡ºåˆ©',
            'å¹³å®‰å–œä¹', 'ä¸å¼€å¿ƒå°±å»çœ‹çœ‹çŒ«çŒ«', 'é‡è§éƒ½æ˜¯ç¤¼ç‰©', 'çƒ­çˆ±å°±åœ¨æ­¤åˆ»', 'ç”Ÿæ´»ä¼šæŠ±æŠ±ä½ ', 'ä½ çš„å°å¤ªé˜³æ¥äº†',
            'å–„å¾…è‡ªå·±', 'åˆ«å¿˜äº†å‘¼å¸', 'æ·±å¤œä¹Ÿä¼šæœ‰æ˜Ÿå…‰', 'ä½ å€¼å¾—æœ€å¥½çš„', 'æ„¿ä¸–ç•Œæ¸©æŸ”å¾…ä½ ',
            'æ„Ÿè°¢æœ‰ä½ ', 'æ¯ä¸€å¤©éƒ½æ–°çš„å¼€å§‹', 'ä¸€èµ·å‘é˜³', 'ç›¸ä¿¡å…‰', 'æœªæ¥åœ¨ç­‰ä½ ', 'ç»§ç»­å‰è¿›',
            'æ²¡æœ‰è¿‡ä¸å»çš„å', 'è®°å¾—åƒæ°´æœ', 'è¦å¼€å¿ƒå™¢', 'æ˜Ÿå…‰ä¸é—®èµ¶è·¯äºº', 'æ˜å¤©ä¼šæ›´å¥½',
            'æ”¾ä¸‹ç„¦è™‘', 'é£ä¼šå‘Šè¯‰ä½ æ–¹å‘', 'å¹¸ç¦å°±åœ¨èº«è¾¹', 'ä½ å·²ç»åšå¾—å¾ˆå¥½', 'å–„è‰¯çš„äººæœ€å¹¸è¿',
            'æ—¶é—´ä¼šæ²»æ„ˆä¸€åˆ‡', 'æ¸©æš–æ°¸ä¸ç¼ºå¸­', 'è½©è½©å¤©å¤©ç¾ä¸½', 'åˆ«å¿˜è®°åˆå¿ƒ', 'æ¯ä¸€æ­¥éƒ½ç®—æ•°',
            'å¤œè‰²æ¸©æŸ”', 'æ—©ç‚¹ä¼‘æ¯å‘€', 'æ²¡æœ‰ä»€ä¹ˆæ˜¯åƒå°å­©è§£å†³ä¸äº†çš„ï¼Œå¦‚æœæœ‰é‚£å°±å†åƒä¸€ä¸ª', 
            'æœ‰æ¢¦å°±å»è¿½', 'ä½ æ˜¯æœ€ç¾çš„æ„å¤–', 'å‹‡æ•¢ä¸€ç‚¹', 'åˆ«æ€•çŠ¯é”™', 'é›¨åä¼šæ™´', 'ä½ å€¼å¾—æ‰€æœ‰ç¾å¥½',
            'çˆ±ä½ çˆ±ä½ ', 'åˆ«å¿˜äº†ä¼‘æ¯', 'å–æ¯å¥¶èŒ¶', 'å¼€å¿ƒæ¯ä¸€å¤©', 'å¿ƒè‹¥å‘é˜³æ— ç•æ‚²ä¼¤',
            'å¥½è¿è¿è¿', 'è½©å§æœ€å¯çˆ±', 'ä½ å¾ˆæ£’ï¼', 'æ¸©æŸ”åˆåšå®š', 'åšä¸ªå‘å…‰çš„äºº', 'æ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸€ä»¶è£™å­è§£å†³ä¸äº†çš„ï¼Œå¦‚æœæœ‰é‚£å°±ä¸¤ä»¶',
            'ç”Ÿæ´»è¦æœ‰å°æƒŠå–œ', 'æœŸå¾…æ˜å¤©', 'çæƒœç°åœ¨', 'æ¢¦ä¼šå®ç°', 'ä¿æŒçƒ­æƒ…', 'å»æ„Ÿå—é£å’Œè‡ªç”±',
            'å¹¸ç¦æ˜¯ä¸€ç§é€‰æ‹©', 'çŒ«çŒ«æ‹¯æ•‘ä¸–ç•Œ', 'ä½ çš„å°å¯çˆ±æ¥äº†', 'è¦ä¸€ç›´å¹¸ç¦å‘€ğŸ’–', 'æ˜å¤©è§ï½'  
        ];
        
        // é¢œè‰²æ–¹æ¡ˆ
        const COLORS = [
            [255, 107, 157], [255, 138, 180], [255, 168, 201],
            [255, 198, 221], [255, 64, 129], [245, 0, 87]
        ];
        
        const BG_COLORS = [
            [255, 182, 193], [255, 192, 203], [255, 218, 185],
            [255, 228, 225], [255, 240, 245], [255, 250, 250]
        ];
        
        // å·¥å…·å‡½æ•°
        function random(min, max) {
            return Math.random() * (max - min) + min;
        }
        
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function randomChoice(arr) {
            return arr[randomInt(0, arr.length - 1)];
        }
        
        // é£å¹•æ–¹å‘å®šä¹‰
        const directions = [
            { dx: '0vw', dy: '-80vh' },   // ä¸Š
            { dx: '0vw', dy: '80vh' },    // ä¸‹
            { dx: '-80vw', dy: '0vh' },   // å·¦
            { dx: '80vw', dy: '0vh' },    // å³
            { dx: '-70vw', dy: '-70vh' }, // å·¦ä¸Š
            { dx: '70vw', dy: '-70vh' },  // å³ä¸Š
            { dx: '-70vw', dy: '70vh' },  // å·¦ä¸‹
            { dx: '70vw', dy: '70vh' },   // å³ä¸‹
            { dx: '0vw', dy: '-60vh' },   // ä¸­ä¸Š
            { dx: '0vw', dy: '60vh' },    // ä¸­ä¸‹
            { dx: '-60vw', dy: '0vh' },   // ä¸­å·¦
            { dx: '60vw', dy: '0vh' }     // ä¸­å³
        ];
        
        // éšæœºé¢œè‰²å‡½æ•°
        function randomColor() {
            const colors = [
                ['#ff758c', '#ff7eb3'],
                ['#a18cd1', '#fbc2eb'],
                ['#f6d365', '#fda085'],
                ['#84fab0', '#8fd3f4'],
                ['#f093fb', '#f5576c'],
                ['#4facfe', '#00f2fe'],
                ['#43e97b', '#38f9d7'],
                ['#fa709a', '#fee140'],
                ['#30cfd0', '#330867'],
                ['#5ee7df', '#b490ca']
            ];
            const c = colors[Math.floor(Math.random() * colors.length)];
            return `linear-gradient(135deg, ${c[0]}, ${c[1]})`;
        }
        
        // ç²’å­ç±»
        class Particle {
            constructor(x, y, size, color, speedX, speedY, isBackground = false) {
                this.x = x;
                this.y = y;
                this.size = size;
                this.color = color;
                this.speedX = speedX;
                this.speedY = speedY;
                this.alpha = 255;
                this.isBackground = isBackground;
                this.originalX = x;
                this.originalY = y;
                this.targetX = x;
                this.targetY = y;
                this.animationProgress = 0;
                this.life = isBackground ? randomInt(100, 200) : 255;
            }
            
            move() {
                if (this.isBackground) {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    this.life--;
                    
                    if (this.x <= 0 || this.x >= SCREEN_WIDTH) {
                        this.speedX *= -1;
                    }
                    if (this.y <= 0 || this.y >= SCREEN_HEIGHT) {
                        this.speedY *= -1;
                    }
                    
                    return this.life <= 0;
                } else {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    this.alpha = Math.max(0, this.alpha - 2);
                    return false;
                }
            }
            
            moveToTarget(speed = 0.05) {
                if (this.isBackground) {
                    return true;
                }
                
                this.animationProgress = Math.min(1.0, this.animationProgress + speed);
                const ease = 1 - Math.pow(1 - this.animationProgress, 3);
                
                this.x = this.originalX + (this.targetX - this.originalX) * ease;
                this.y = this.originalY + (this.targetY - this.originalY) * ease;
                
                return this.animationProgress >= 1.0;
            }
            
            setTarget(targetX, targetY) {
                this.targetX = targetX;
                this.targetY = targetY;
                this.originalX = this.x;
                this.originalY = this.y;
                this.animationProgress = 0;
            }
            
            draw(ctx) {
                ctx.save();
                const alpha = this.isBackground ? Math.min(200, this.life * 2) / 255 : this.alpha / 255;
                ctx.fillStyle = `rgba(${this.color[0]}, ${this.color[1]}, ${this.color[2]}, ${alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }
        
        // éŸ³é¢‘æ§åˆ¶å™¨ç±»
        class AudioController {
            constructor() {
                this.audio = document.getElementById('backgroundMusic');
                this.isPlaying = false;
                this.musicIndicator = document.getElementById('musicIndicator');
                
                // è®¾ç½®éŸ³é¢‘éŸ³é‡
                this.audio.volume = 0.7;
                
                // æ·»åŠ éŸ³é¢‘äº‹ä»¶ç›‘å¬
                this.audio.addEventListener('play', () => {
                    this.isPlaying = true;
                    this.musicIndicator.classList.add('playing');
                    console.log('éŸ³ä¹å¼€å§‹æ’­æ”¾');
                });
                
                this.audio.addEventListener('pause', () => {
                    this.isPlaying = false;
                    this.musicIndicator.classList.remove('playing');
                    console.log('éŸ³ä¹æš‚åœ');
                });
                
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                // éŸ³ä¹æŒ‡ç¤ºå™¨ç‚¹å‡»äº‹ä»¶
                this.musicIndicator.addEventListener('click', () => {
                    this.toggle();
                });
            }
            
            // æ’­æ”¾éŸ³ä¹
            play() {
                this.audio.play().catch(error => {
                    console.log('æ’­æ”¾å¤±è´¥:', error);
                });
            }
            
            // æš‚åœéŸ³ä¹
            pause() {
                this.audio.pause();
            }
            
            // åˆ‡æ¢æ’­æ”¾çŠ¶æ€
            toggle() {
                if (this.isPlaying) {
                    this.pause();
                } else {
                    this.play();
                }
            }
        }
        
        // ç²’å­å€’è®¡æ—¶æ§åˆ¶å™¨
        class ParticleCountdown {
            constructor() {
                this.canvas = document.getElementById('countdownCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.canvas.width = SCREEN_WIDTH;
                this.canvas.height = SCREEN_HEIGHT;
                this.canvas.style.display = 'block';
                
                this.particles = [];
                this.backgroundParticles = [];
                
                this.currentNumber = 3;
                this.animationPhase = "form";
                this.animationProgress = 0;
                this.animationSpeed = 0.03;
                this.holdTime = 0;
                this.done = false;
                
                this.bgColor = BLACK;
                
                this.createBackgroundParticles();
                this.createParticlesForNumber(this.currentNumber);
                
                this.lastTime = 0;
            }
            
            createBackgroundParticles() {
                const numParticles = 100;
                for (let i = 0; i < numParticles; i++) {
                    const x = randomInt(0, SCREEN_WIDTH);
                    const y = randomInt(0, SCREEN_HEIGHT);
                    const size = randomInt(2, 4);
                    const color = randomChoice(BG_COLORS);
                    const speedX = random(-0.5, 0.5);
                    const speedY = random(-0.5, 0.5);
                    
                    const particle = new Particle(x, y, size, color, speedX, speedY, true);
                    this.backgroundParticles.push(particle);
                }
            }
            
            createParticlesForNumber(number) {
                this.particles = [];
                
                // åˆ›å»ºä¸´æ—¶Canvasæ¥ç»˜åˆ¶æ•°å­—
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = SCREEN_WIDTH;
                tempCanvas.height = SCREEN_HEIGHT;
                const tempCtx = tempCanvas.getContext('2d');
                
                tempCtx.fillStyle = WHITE;
                tempCtx.font = 'bold 200px Arial';
                tempCtx.textAlign = 'center';
                tempCtx.textBaseline = 'middle';
                tempCtx.fillText(number, SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2);
                
                const textPixels = [];
                const imageData = tempCtx.getImageData(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
                const data = imageData.data;
                
                for (let y = 0; y < SCREEN_HEIGHT; y++) {
                    for (let x = 0; x < SCREEN_WIDTH; x++) {
                        const index = (y * SCREEN_WIDTH + x) * 4;
                        if (data[index + 3] > 128) {
                            textPixels.push({ x, y });
                        }
                    }
                }
                
                const sampleSize = Math.min(500, textPixels.length);
                const sampledPixels = [];
                for (let i = 0; i < sampleSize; i++) {
                    const index = randomInt(0, textPixels.length - 1);
                    sampledPixels.push(textPixels[index]);
                    textPixels.splice(index, 1);
                }
                
                for (const { x, y } of sampledPixels) {
                    const startX = randomInt(0, SCREEN_WIDTH);
                    const startY = randomInt(0, SCREEN_HEIGHT);
                    
                    const size = randomInt(3, 6);
                    const color = randomChoice(COLORS);
                    const speedX = random(-1, 1);
                    const speedY = random(-1, 1);
                    
                    const particle = new Particle(startX, startY, size, color, speedX, speedY);
                    particle.setTarget(x, y);
                    
                    this.particles.push(particle);
                }
            }
            
            update(deltaTime) {
                const deadParticles = [];
                for (const particle of this.backgroundParticles) {
                    if (particle.move()) {
                        deadParticles.push(particle);
                    }
                }
                
                for (const particle of deadParticles) {
                    this.backgroundParticles.splice(this.backgroundParticles.indexOf(particle), 1);
                    
                    const x = randomInt(0, SCREEN_WIDTH);
                    const y = randomInt(0, SCREEN_HEIGHT);
                    const size = randomInt(2, 4);
                    const color = randomChoice(BG_COLORS);
                    const speedX = random(-0.5, 0.5);
                    const speedY = random(-0.5, 0.5);
                    
                    const newParticle = new Particle(x, y, size, color, speedX, speedY, true);
                    this.backgroundParticles.push(newParticle);
                }
                
                if (this.animationPhase === "form") {
                    let allArrived = true;
                    for (const particle of this.particles) {
                        if (!particle.moveToTarget(this.animationSpeed)) {
                            allArrived = false;
                        }
                    }
                    
                    if (allArrived) {
                        this.animationPhase = "hold";
                        this.holdTime = Date.now();
                    }
                } else if (this.animationPhase === "hold") {
                    if (Date.now() - this.holdTime > 1000) {
                        this.animationPhase = "disperse";
                        this.animationProgress = 0;
                        
                        for (const particle of this.particles) {
                            const angle = random(0, 2 * Math.PI);
                            const distance = random(100, 300);
                            let targetX = particle.x + Math.cos(angle) * distance;
                            let targetY = particle.y + Math.sin(angle) * distance;
                            
                            targetX = Math.max(0, Math.min(targetX, SCREEN_WIDTH));
                            targetY = Math.max(0, Math.min(targetY, SCREEN_HEIGHT));
                            
                            particle.setTarget(targetX, targetY);
                        }
                    }
                } else if (this.animationPhase === "disperse") {
                    let allArrived = true;
                    for (const particle of this.particles) {
                        if (!particle.moveToTarget(this.animationSpeed * 2)) {
                            allArrived = false;
                        }
                    }
                    
                    if (allArrived) {
                        this.currentNumber--;
                        if (this.currentNumber > 0) {
                            this.animationPhase = "form";
                            this.createParticlesForNumber(this.currentNumber);
                        } else {
                            for (const particle of this.particles) {
                                const angle = random(0, 2 * Math.PI);
                                const distance = 1000;
                                const targetX = particle.x + Math.cos(angle) * distance;
                                const targetY = particle.y + Math.sin(angle) * distance;
                                particle.setTarget(targetX, targetY);
                            }
                            
                            this.animationPhase = "final_disperse";
                        }
                    }
                } else if (this.animationPhase === "final_disperse") {
                    let allArrived = true;
                    for (const particle of this.particles) {
                        if (!particle.moveToTarget(this.animationSpeed)) {
                            allArrived = false;
                        }
                    }
                    
                    if (allArrived) {
                        this.done = true;
                    }
                }
            }
            
            draw() {
                this.ctx.fillStyle = this.bgColor;
                this.ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
                
                for (const particle of this.backgroundParticles) {
                    particle.draw(this.ctx);
                }
                
                for (const particle of this.particles) {
                    particle.draw(this.ctx);
                }
            }
            
            run(timestamp) {
                if (!this.lastTime) this.lastTime = timestamp;
                const deltaTime = timestamp - this.lastTime;
                this.lastTime = timestamp;
                
                if (!this.done) {
                    this.update(deltaTime);
                    this.draw();
                    requestAnimationFrame(this.run.bind(this));
                } else {
                    this.canvas.style.display = 'none';
                    // å¯åŠ¨é£å¹•æ•ˆæœ
                    const flyEffect = new FlyMessageEffect();
                    flyEffect.start();
                }
            }
        }
        
        // é£å¹•æ•ˆæœç±»
        class FlyMessageEffect {
            constructor() {
                this.stage = document.getElementById('stage');
                this.stage.style.display = 'block';
                this.running = false;
                this.messageCount = 0;
                this.maxMessages = 200; // é™åˆ¶æ¶ˆæ¯æ•°é‡ï¼Œé¿å…æ€§èƒ½é—®é¢˜
            }
            
            createMessage() {
                if (this.messageCount >= this.maxMessages) return;
                
                const el = document.createElement('div');
                el.className = 'msg';
                const d = randomChoice(directions);
                el.style.setProperty('--dx', d.dx);
                el.style.setProperty('--dy', d.dy);
                el.style.setProperty('--rot', random(-60, 60) + 'deg');
                el.style.setProperty('--dur', (random(6.5, 9)) + 's');
                el.style.setProperty('--delay', (this.messageCount * 0.13 + random(0, 0.5)) + 's');
                el.style.background = randomColor();
                el.textContent = randomChoice(TIPS);
                el.addEventListener('animationend', () => {
                    el.remove();
                    this.messageCount--;
                });
                this.stage.appendChild(el);
                this.messageCount++;
            }
            
            start() {
                this.running = true;
                
                // æŒç»­åˆ›å»ºæ¶ˆæ¯
                const createInterval = setInterval(() => {
                    if (this.running) {
                        this.createMessage();
                    } else {
                        clearInterval(createInterval);
                    }
                }, 200); // æ¯200æ¯«ç§’åˆ›å»ºä¸€ä¸ªæ–°æ¶ˆæ¯
                
                // æ·»åŠ ESCé”®é€€å‡ºåŠŸèƒ½
                const escHandler = (event) => {
                    if (event.key === 'Escape') {
                        this.stop();
                    }
                };
                document.addEventListener('keydown', escHandler);
                this.escHandler = escHandler;
            }
            
            stop() {
                this.running = false;
                document.removeEventListener('keydown', this.escHandler);
                this.stage.style.display = 'none';
                document.getElementById('exitHint').style.display = 'none';
            }
        }
        
        // ä¸»å‡½æ•°
        function main() {
            // åˆ›å»ºéŸ³é¢‘æ§åˆ¶å™¨
            const audioController = new AudioController();
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼Œç”¨äºè§¦å‘éŸ³é¢‘æ’­æ”¾
            const playAudioOnInteraction = () => {
                audioController.play();
                // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…é‡å¤è§¦å‘
                document.removeEventListener('click', playAudioOnInteraction);
                document.removeEventListener('keydown', playAudioOnInteraction);
            };
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’
            document.addEventListener('click', playAudioOnInteraction);
            document.addEventListener('keydown', playAudioOnInteraction);
            
            // å…ˆè¿è¡Œç²’å­å€’è®¡æ—¶
            const countdown = new ParticleCountdown();
            requestAnimationFrame(countdown.run.bind(countdown));
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨ç¨‹åº
        window.addEventListener('load', main);
    </script>
</body>
</html>


